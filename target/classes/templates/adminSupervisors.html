<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Админ Панель</title>
    <link th:href="@{/css/Panel.css}" rel="stylesheet" />
    <link rel="stylesheet" href="Panel.css">
    <!-- Подключение jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<nav id="nav-uniq">
    <h2>Панель администрирования супервизоров</h2>
</nav>

<div class="form-container">
    <h2>Создать супервизора</h2>
    <form id="createSupervisorForm" th:action="@{/admin/supervisor/create}" method="post">
        <div class="input-container">
            <label for="createSupervisorEmail">Email супервизора:</label>
            <input type="text" id="createSupervisorEmail" name="email" required placeholder=" "/><br/>
        </div>
        <div class="input-container">
            <label for="supervisorFirstName">Имя супервизора:</label>
            <input type="text" id="supervisorFirstName" name="first_name" required placeholder=" "/><br/>
        </div>
        <div class="input-container">
            <label for="supervisorLastName">Фамилия супервизора:</label>
            <input type="text" id="supervisorLastName" name="last_name" required placeholder=" "/><br/>
        </div>
        <div class="input-container">
            <label for="supervisorPersonalData">Личные данные супервизора:</label>
            <input type="text" id="supervisorPersonalData" name="personal_data" required placeholder=" "/><br/>
        </div>
        <button type="button" onclick="createSupervisor()" class="align-right">Создать супервизора</button>
    </form>

</div>

<div id="createSupervisorResultContainer"></div>

<div class="form-container">
    <h2>Получить всех супервизоров</h2>
    <button type="button" onclick="getAllSupervisors()" class="align-right">Получить всех супервизоров</button>
</div>

<div id="supervisorsDataContainer"></div>

<<div class="form-container">
    <h2>Получить супервизора по email</h2>
    <form id="getSupervisorForm">
        <div class="input-container">
            <label for="getSupervisorEmail">Email супервизора:</label>
            <input type="text" id="getSupervisorEmail" name="email" required placeholder=" "/><br/>
        </div>
        <button type="button" onclick="getSupervisorByEmail()" id="getSupervisorByEmailButton" class="align-right">Получить супервизора</button>
    </form>
</div>

<div id="supervisorByEmailResultContainer"></div>

<div class="form-container">
    <h2>Добавить кураторов по email супервизора</h2>
    <form id="addCuratorsToSupervisorForm">
        <!--<label for="supervisorEmail">Email супервизора:</label>-->
        <div class="input-container">
            <label for="supervisorEmailCurators">Email супервизора:</label>
            <input type="text" id="supervisorEmailCurators" name="email" required placeholder=" "/><br/>
        </div>
        <div class="input-container">
            <label for="curatorsEmails">Email кураторов (разделите запятыми):</label>
            <input type="text" id="curatorsEmails" name="curators_emails" required placeholder=" "/><br/>
        </div>
        <button type="button" id="addCuratorsToSupervisorButton" class="align-right">Добавить кураторов</button>
    </form>
</div>

<div id="addCuratorsToSupervisorResultContainer"></div>

<div class="form-container">
    <h2>Обновить информацию о супервизоре</h2>
    <form id="updateSupervisorForm">
        <div class="input-container">
            <label for="createSupervisorEmail">Email супервизора:</label>
            <input type="text" id="updateSupervisorEmail" name="email" required placeholder=" "/><br/>
        </div>
        <div class="input-container">
            <label for="updateSupervisorFirstName">Имя супервизора:</label>
            <input type="text" id="updateSupervisorFirstName" name="first_name" required placeholder=" "/><br/>
        </div>
        <div class="input-container">
            <label for="updateSupervisorLastName">Фамилия супервизора:</label>
            <input type="text" id="updateSupervisorLastName" name="last_name" required placeholder=" "/><br/>
        </div>
        <div class="input-container">
            <label for="updateSupervisorPersonalData">Личные данные супервизора:</label>
            <input type="text" id="updateSupervisorPersonalData" name="personal_data" required placeholder=" "/><br/>
        </div>

        <button type="button" onclick="updateSupervisor()" class="align-right">Обновить информацию о супервизоре</button>
    </form>
</div>

<div id="updateSupervisorResultContainer"></div>

<div class="form-container">
    <h2>Удалить супервизора</h2>
    <form id="deleteSupervisorForm">
        <div class="input-container">
            <label for="deleteSupervisorEmail">Email супервизора:</label>
            <input type="text" id="deleteSupervisorEmail" name="email" required placeholder=" "/><br/>
        </div>
        <button type="button" onclick="deleteSupervisor()" class="align-right">Удалить супервизора</button>
    </form>
</div>

<div id="deleteSupervisorResultContainer"></div>

<script th:inline="javascript">

    function updateSupervisor() {
        var form = document.getElementById('updateSupervisorForm');
        var supervisorData = {
            "email": form.email.value,
            "first_name": form.first_name.value,
            "last_name": form.last_name.value,
            "personal_data": form.personal_data.value
        };

        var supervisorEmail = document.getElementById('updateSupervisorEmail').value;

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/admin/supervisor/update/' + supervisorEmail, true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                var responseContainer = document.getElementById('updateSupervisorResultContainer');

                responseContainer.innerHTML = '';

                if (xhr.status === 200) {

                    var supervisorInfo = JSON.parse(xhr.responseText);

                    // Display each attribute in a separate paragraph
                    for (var key in supervisorInfo) {
                        if (supervisorInfo.hasOwnProperty(key)) {
                            var attributeInfo = document.createElement('p');
                            attributeInfo.textContent = key + ': ' + supervisorInfo[key];
                            responseContainer.appendChild(attributeInfo);
                        }
                    }
                } else {

                    responseContainer.innerHTML = '<p>Error: ' + xhr.responseText + '</p>';
                }
            }
        };

        xhr.send(JSON.stringify(supervisorData));
    }

    function deleteSupervisor() {
        var supervisorEmail = $('#deleteSupervisorEmail').val();
        $.ajax({
            url: '/admin/supervisor/delete/' + supervisorEmail,
            type: 'DELETE',
            success: function(response) {
                /* Отображение результата в блоке с id="deleteSupervisorResultContainer" */
                $('#deleteSupervisorResultContainer').html(response);
            },
            error: function(error) {
                /* В случае ошибки выводим сообщение об ошибке */
                $('#deleteSupervisorResultContainer').html('Ошибка: ' + error.responseText);
            }
        });
    }
    function getSupervisorByEmail() {
        var supervisorEmail = document.getElementById('getSupervisorEmail').value;

        // Выполняем AJAX-запрос
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/admin/supervisor/' + supervisorEmail, true);

        xhr.onload = function() {
            var supervisorContainer = document.getElementById('supervisorByEmailResultContainer');

            if (xhr.status === 200) {
                // Парсим JSON-ответ
                var supervisorData = JSON.parse(xhr.responseText);

                // Очищаем контейнер
                supervisorContainer.innerHTML = '';

                // Создаем элементы для вывода данных
                var supervisorDetails = document.createElement('div');
                supervisorDetails.innerHTML = '<h3>Supervisor Details:</h3>';

                // Добавляем все поля супервизора
                for (var key in supervisorData) {
                    if (supervisorData.hasOwnProperty(key)) {
                        supervisorDetails.innerHTML += '<p>' + key + ': ' + supervisorData[key] + '</p>';
                    }
                }

                // Вставляем элементы в контейнер
                supervisorContainer.appendChild(supervisorDetails);
            } else {
                // Выводим сообщение об ошибке
                supervisorContainer.innerHTML = '<p>Error: ' + xhr.responseText + '</p>';
            }
        };

        xhr.send();
    }
    function createSupervisor() {
        var form = document.getElementById('createSupervisorForm');
        var supervisorData = {
            "email": form.email.value,
            "first_name": form.first_name.value,
            "last_name": form.last_name.value,
            "personal_data": form.personal_data.value
        };

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/admin/supervisor/create', true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                var responseContainer = document.getElementById('createSupervisorResultContainer');
                // Clear previous content
                responseContainer.innerHTML = '';

                if (xhr.status === 200) {
                    // Parse JSON response
                    var supervisorInfo = JSON.parse(xhr.responseText);

                    // Display each attribute in a separate paragraph
                    for (var key in supervisorInfo) {
                        if (supervisorInfo.hasOwnProperty(key)) {
                            var attributeInfo = document.createElement('p');
                            attributeInfo.textContent = key + ': ' + supervisorInfo[key];
                            responseContainer.appendChild(attributeInfo);
                        }
                    }
                } else {
                    // Display error message
                    var errorMessage = document.createElement('p');
                    errorMessage.textContent = 'Error: Проверьте валидность введённых данных';
                    errorMessage.classList.add('error');
                    responseContainer.appendChild(errorMessage);
                }
            }
        };

        xhr.send(JSON.stringify(supervisorData));
    }


    /* Обработчик клика на кнопку для получения всех супервизоров */
    function getAllSupervisors() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/admin/supervisors', true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var supervisorsContainer = document.getElementById('supervisorsDataContainer');
                var supervisors = JSON.parse(xhr.responseText);

                // Создаем таблицу для отображения данных супервизоров
                var tableHtml = '<table border="1">';
                tableHtml += '<tr>';
                for (var key in supervisors[0]) {
                    tableHtml += '<th>' + key + '</th>';
                }
                tableHtml += '</tr>';

                // Добавляем строки с данными супервизоров
                for (var i = 0; i < supervisors.length; i++) {
                    tableHtml += '<tr>';
                    for (var key in supervisors[i]) {
                        tableHtml += '<td>' + supervisors[i][key] + '</td>';
                    }
                    tableHtml += '</tr>';
                }

                tableHtml += '</table>';

                // Выводим таблицу на страницу
                supervisorsContainer.innerHTML = tableHtml;
            }
        };

        xhr.send();
    }

    function addCuratorsToSupervisor() {
        var supervisorEmail = $('#supervisorEmailCurators').val();
        var curatorsEmails = $('#curatorsEmails').val();
        $.post('/admin/supervisor/' + supervisorEmail + '/curators', { curators_emails: curatorsEmails }, function(response) {
            /* Отображение результата в блоке с id="addCuratorsToSupervisorResultContainer" */
            $('#addCuratorsToSupervisorResultContainer').html(response);
        });
    }
</script>

</body>
</html>
